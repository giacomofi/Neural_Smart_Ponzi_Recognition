{"type": "SourceUnit", "children": [{"type": "PragmaDirective", "name": "solidity", "value": "^0.5.11"}, {"type": "ContractDefinition", "name": "SynthetixInterface", "baseContracts": [], "subNodes": [{"type": "FunctionDefinition", "name": "exchange", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "sourceCurrencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "sourceAmount", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "destinationCurrencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amountReceived", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "synths", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}], "kind": "contract"}, {"type": "ContractDefinition", "name": "SynthInterface", "baseContracts": [], "subNodes": [{"type": "FunctionDefinition", "name": "currencyKey", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "_currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "transfer", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "to", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "tokens", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": "success", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "balanceOf", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "_owner", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "balance", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "transferFrom", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "sender", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "recipient", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}], "kind": "contract"}, {"type": "ContractDefinition", "name": "ExchRatesInterface", "baseContracts": [], "subNodes": [{"type": "FunctionDefinition", "name": "rateForCurrency", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "ratesForCurrencies", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "length": null}, "name": "currencyKeys", "storageLocation": "calldata", "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "uint256"}, "length": null}, "name": null, "storageLocation": "memory", "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": "view"}], "kind": "contract"}, {"type": "ContractDefinition", "name": "marginTrade", "baseContracts": [], "subNodes": [{"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "sUSD", "expression": {"type": "StringLiteral", "value": "sUSD"}, "visibility": "private", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "StringLiteral", "value": "sUSD"}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "sETH", "expression": {"type": "StringLiteral", "value": "sETH"}, "visibility": "private", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "StringLiteral", "value": "sETH"}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "IM_BUFFER_OVER_MM", "expression": {"type": "NumberLiteral", "number": "200", "subdenomination": null}, "visibility": "default", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "NumberLiteral", "number": "200", "subdenomination": null}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "e18", "expression": {"type": "BinaryOperation", "operator": "**", "left": {"type": "NumberLiteral", "number": "10", "subdenomination": null}, "right": {"type": "NumberLiteral", "number": "18", "subdenomination": null}}, "visibility": "default", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "BinaryOperation", "operator": "**", "left": {"type": "NumberLiteral", "number": "10", "subdenomination": null}, "right": {"type": "NumberLiteral", "number": "18", "subdenomination": null}}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "SECONDS_IN_YEAR", "expression": {"type": "NumberLiteral", "number": "31557600", "subdenomination": null}, "visibility": "default", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "NumberLiteral", "number": "31557600", "subdenomination": null}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "exchRateAddress", "expression": {"type": "NumberLiteral", "number": "0x9D7F70AF5DF5D5CC79780032d47a34615D1F1d77", "subdenomination": null}, "visibility": "public", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "NumberLiteral", "number": "0x9D7F70AF5DF5D5CC79780032d47a34615D1F1d77", "subdenomination": null}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "synthetixContractAddress", "expression": {"type": "NumberLiteral", "number": "0xC011A72400E58ecD99Ee497CF89E3775d4bd732F", "subdenomination": null}, "visibility": "public", "isStateVar": true, "isDeclaredConst": true, "isIndexed": false}], "initialValue": {"type": "NumberLiteral", "number": "0xC011A72400E58ecD99Ee497CF89E3775d4bd732F", "subdenomination": null}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address", "stateMutability": "payable"}, "name": "lender", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address", "stateMutability": "payable"}, "name": "trader", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "APR", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "maxDurationSecs", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "maxLoanAmt", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "length": null}, "name": "approvedSynths", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "Mapping", "keyType": {"type": "ElementaryTypeName", "name": "bytes32"}, "valueType": {"type": "ElementaryTypeName", "name": "uint"}}, "name": "lenderSynthBalances", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "lenderEthBalance", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "loanStartTS", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "mm", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": "wasLiquidated", "expression": {"type": "BooleanLiteral", "value": false}, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": {"type": "BooleanLiteral", "value": false}}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "Mapping", "keyType": {"type": "ElementaryTypeName", "name": "bytes32"}, "valueType": {"type": "ElementaryTypeName", "name": "address"}}, "name": "synthToAddress", "expression": null, "visibility": "default", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "loanBalance", "expression": null, "visibility": "private", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "lastLoanSettleTS", "expression": null, "visibility": "private", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "FunctionDefinition", "name": null, "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address", "stateMutability": "payable"}, "name": "_lenderAddress", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address", "stateMutability": "payable"}, "name": "_traderAddress", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_APR", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_maxDurationSecs", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_maxLoanAmt", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_mm", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "length": null}, "name": "_approvedSynths", "storageLocation": "memory", "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "address"}, "length": null}, "name": "_approvedSynthAddresses", "storageLocation": "memory", "isStateVar": false, "isIndexed": false}]}, "returnParameters": null, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lender"}, "right": {"type": "Identifier", "name": "_lenderAddress"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "trader"}, "right": {"type": "Identifier", "name": "_traderAddress"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "APR"}, "right": {"type": "Identifier", "name": "_APR"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "maxDurationSecs"}, "right": {"type": "Identifier", "name": "_maxDurationSecs"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "maxLoanAmt"}, "right": {"type": "Identifier", "name": "_maxLoanAmt"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "mm"}, "right": {"type": "Identifier", "name": "_mm"}}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": "sUSDFound", "storageLocation": null}], "initialValue": {"type": "BooleanLiteral", "value": false}}, {"type": "ForStatement", "initExpression": {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "i", "storageLocation": null}], "initialValue": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "conditionExpression": {"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "i"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "_approvedSynths"}, "memberName": "length"}}, "loopExpression": {"type": "ExpressionStatement", "expression": {"type": "UnaryOperation", "operator": "++", "subExpression": {"type": "Identifier", "name": "i"}, "isPrefix": false}}, "body": {"type": "Block", "statements": [{"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "_approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}, "right": {"type": "Identifier", "name": "sUSD"}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "sUSDFound"}, "right": {"type": "BooleanLiteral", "value": true}}}]}, "FalseBody": null}]}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "Identifier", "name": "sUSDFound"}, {"type": "StringLiteral", "value": "sUSD must be among the approved synths."}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "approvedSynths"}, "right": {"type": "Identifier", "name": "_approvedSynths"}}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "approvedSynths"}, "memberName": "length"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "_approvedSynthAddresses"}, "memberName": "length"}}, {"type": "StringLiteral", "value": "lengths dont match."}], "names": []}}, {"type": "ForStatement", "initExpression": {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "i", "storageLocation": null}], "initialValue": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "conditionExpression": {"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "i"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "approvedSynths"}, "memberName": "length"}}, "loopExpression": {"type": "ExpressionStatement", "expression": {"type": "UnaryOperation", "operator": "++", "subExpression": {"type": "Identifier", "name": "i"}, "isPrefix": false}}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "synthToAddress"}, "index": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}}, "right": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "_approvedSynthAddresses"}, "index": {"type": "Identifier", "name": "i"}}}}]}}]}, "visibility": "public", "modifiers": [], "isConstructor": true, "stateMutability": null}, {"type": "FunctionDefinition", "name": "", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": [], "body": {"type": "Block", "statements": []}, "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": "payable"}, {"type": "FunctionDefinition", "name": "setMaxLoanAmount", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_maxLoanAmt", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "trader"}}, {"type": "StringLiteral", "value": "Only the Trader can change the desired max loan amt"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "maxLoanAmt"}, "right": {"type": "Identifier", "name": "_maxLoanAmt"}}}]}, "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "depositFunds", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "UserDefinedTypeName", "namePath": "SynthInterface"}, "name": "token", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "token"}, "memberName": "currencyKey"}, "arguments": [], "names": []}, "right": {"type": "Identifier", "name": "sUSD"}}, {"type": "StringLiteral", "value": "Loan deposit must be sUSD"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "amount"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_svPre", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "traderTotSynthValueUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_newLoanBalance", "storageLocation": null}], "initialValue": {"type": "BinaryOperation", "operator": "+", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}, "right": {"type": "Identifier", "name": "amount"}}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "<=", "left": {"type": "Identifier", "name": "_newLoanBalance"}, "right": {"type": "Identifier", "name": "maxLoanAmt"}}, {"type": "StringLiteral", "value": "loan amount too high"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "Identifier", "name": "isInitialMarginSatisfied"}, "arguments": [{"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "_svPre"}, "right": {"type": "Identifier", "name": "amount"}}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "collValueUSD"}, "arguments": [], "names": []}, {"type": "Identifier", "name": "_newLoanBalance"}, {"type": "Identifier", "name": "mm"}], "names": []}, {"type": "StringLiteral", "value": "Not enough collateral in the contract."}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "token"}, "memberName": "transferFrom"}, "arguments": [{"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, {"type": "Identifier", "name": "amount"}], "names": []}, {"type": "StringLiteral", "value": "token transfer failed"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "Identifier", "name": "_newLoanBalance"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lastLoanSettleTS"}, "right": {"type": "Identifier", "name": "now"}}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "loanStartTS"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanStartTS"}, "right": {"type": "Identifier", "name": "now"}}}]}, "FalseBody": null}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "trade", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "sourceCurrencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "sourceAmount", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "destCurrencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "trader"}}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">=", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "synthBalanceTrader"}, "arguments": [{"type": "Identifier", "name": "sourceCurrencyKey"}], "names": []}, "right": {"type": "Identifier", "name": "sourceAmount"}}, {"type": "StringLiteral", "value": "trader does not have enough balance"}], "names": []}}, {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "SynthetixInterface"}, "arguments": [{"type": "Identifier", "name": "synthetixContractAddress"}], "names": []}, "memberName": "exchange"}, "arguments": [{"type": "Identifier", "name": "sourceCurrencyKey"}, {"type": "Identifier", "name": "sourceAmount"}, {"type": "Identifier", "name": "destCurrencyKey"}], "names": []}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "liquidate", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "UnaryOperation", "operator": "!", "subExpression": {"type": "Identifier", "name": "wasLiquidated"}, "isPrefix": true}, {"type": "StringLiteral", "value": "already liquidated"}], "names": []}}, {"type": "IfStatement", "condition": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "isLiquidationable"}, "arguments": [], "names": []}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lenderEthBalance"}, "right": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, "memberName": "balance"}}}, {"type": "ForStatement", "initExpression": {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "i", "storageLocation": null}], "initialValue": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "conditionExpression": {"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "i"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "approvedSynths"}, "memberName": "length"}}, "loopExpression": {"type": "ExpressionStatement", "expression": {"type": "UnaryOperation", "operator": "++", "subExpression": {"type": "Identifier", "name": "i"}, "isPrefix": false}}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_bal", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "SynthInterface"}, "arguments": [{"type": "IndexAccess", "base": {"type": "Identifier", "name": "synthToAddress"}, "index": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}}], "names": []}, "memberName": "balanceOf"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}}, "right": {"type": "Identifier", "name": "_bal"}}}]}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "wasLiquidated"}, "right": {"type": "BooleanLiteral", "value": true}}}]}, "FalseBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "revert"}, "arguments": [{"type": "StringLiteral", "value": "not liquidation eligible"}], "names": []}}]}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "traderWithdrawEth", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amt", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "trader"}}, {"type": "StringLiteral", "value": "Only trader can withdraw eth"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "<=", "left": {"type": "Identifier", "name": "amt"}, "right": {"type": "BinaryOperation", "operator": "-", "left": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, "memberName": "balance"}, "right": {"type": "Identifier", "name": "lenderEthBalance"}}}, {"type": "StringLiteral", "value": "withdraw amt too high"}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "usdAmt", "storageLocation": null}], "initialValue": {"type": "BinaryOperation", "operator": "/", "left": {"type": "BinaryOperation", "operator": "*", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRate"}, "arguments": [{"type": "Identifier", "name": "sETH"}], "names": []}, "right": {"type": "Identifier", "name": "amt"}}, "right": {"type": "Identifier", "name": "e18"}}}, {"type": "IfStatement", "condition": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "isInitialMarginSatisfied"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "Identifier", "name": "traderTotSynthValueUSD"}, "arguments": [], "names": []}, {"type": "BinaryOperation", "operator": "-", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "collValueUSD"}, "arguments": [], "names": []}, "right": {"type": "Identifier", "name": "usdAmt"}}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}, {"type": "Identifier", "name": "mm"}], "names": []}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "trader"}], "names": []}, "memberName": "transfer"}, "arguments": [{"type": "Identifier", "name": "amt"}], "names": []}}]}, "FalseBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "revert"}, "arguments": [{"type": "StringLiteral", "value": "Cant withdraw that much"}], "names": []}}]}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "payable"}, {"type": "FunctionDefinition", "name": "lenderWithdrawEth", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amt", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "lender"}}, {"type": "StringLiteral", "value": "Only lender can withdraw eth"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "<=", "left": {"type": "Identifier", "name": "amt"}, "right": {"type": "Identifier", "name": "lenderEthBalance"}}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "lender"}], "names": []}, "memberName": "transfer"}, "arguments": [{"type": "Identifier", "name": "amt"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lenderEthBalance"}, "right": {"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "lenderEthBalance"}, "right": {"type": "Identifier", "name": "amt"}}}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "payable"}, {"type": "FunctionDefinition", "name": "traderWithdrawSynth", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amt", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "trader"}}, {"type": "StringLiteral", "value": "Only trader can withdraw synths."}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "!=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "synthToAddress"}, "index": {"type": "Identifier", "name": "currencyKey"}}, "right": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "NumberLiteral", "number": "0", "subdenomination": null}], "names": []}}, {"type": "StringLiteral", "value": "currency key not in approved list"}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "usdAmt", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "_synthValueUSD"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRate"}, "arguments": [{"type": "Identifier", "name": "currencyKey"}], "names": []}, {"type": "Identifier", "name": "amt"}], "names": []}}, {"type": "IfStatement", "condition": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "isInitialMarginSatisfied"}, "arguments": [{"type": "BinaryOperation", "operator": "-", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "traderTotSynthValueUSD"}, "arguments": [], "names": []}, "right": {"type": "Identifier", "name": "usdAmt"}}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "collValueUSD"}, "arguments": [], "names": []}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}, {"type": "Identifier", "name": "mm"}], "names": []}, "TrueBody": {"type": "Block", "statements": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "SynthInterface"}, "arguments": [{"type": "IndexAccess", "base": {"type": "Identifier", "name": "synthToAddress"}, "index": {"type": "Identifier", "name": "currencyKey"}}], "names": []}, "memberName": "transfer"}, "arguments": [{"type": "Identifier", "name": "trader"}, {"type": "Identifier", "name": "amt"}], "names": []}]}, "FalseBody": null}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "revert"}, "arguments": [{"type": "StringLiteral", "value": "Cant withdraw that much"}], "names": []}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "lenderWithdrawSynth", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amt", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "lender"}}, {"type": "StringLiteral", "value": "Only lender can withdraw synths."}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "currencyKey"}}, "right": {"type": "Identifier", "name": "amt"}}, {"type": "StringLiteral", "value": "Withdraw amt is too high."}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": "result", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "SynthInterface"}, "arguments": [{"type": "IndexAccess", "base": {"type": "Identifier", "name": "synthToAddress"}, "index": {"type": "Identifier", "name": "currencyKey"}}], "names": []}, "memberName": "transfer"}, "arguments": [{"type": "Identifier", "name": "lender"}, {"type": "Identifier", "name": "amt"}], "names": []}}, {"type": "IfStatement", "condition": {"type": "Identifier", "name": "result"}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "currencyKey"}}, "right": {"type": "BinaryOperation", "operator": "-", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "currencyKey"}}, "right": {"type": "Identifier", "name": "amt"}}}}]}, "FalseBody": null}, {"type": "Identifier", "name": "result"}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "traderRepayLoan", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "trader"}}, {"type": "StringLiteral", "value": "only trader can repay loan"}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_loanBalance", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_amt", "storageLocation": null}], "initialValue": null}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "amount"}, "right": {"type": "Identifier", "name": "_loanBalance"}}, "TrueBody": {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "_amt"}, "right": {"type": "Identifier", "name": "_loanBalance"}}}, "FalseBody": {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "_amt"}, "right": {"type": "Identifier", "name": "amount"}}}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">=", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "synthBalanceTrader"}, "arguments": [{"type": "Identifier", "name": "sUSD"}], "names": []}, "right": {"type": "Identifier", "name": "_amt"}}, {"type": "StringLiteral", "value": "Not enough sUSD to repay."}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "_loanBalance"}, "right": {"type": "Identifier", "name": "_amt"}}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lastLoanSettleTS"}, "right": {"type": "Identifier", "name": "now"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "sUSD"}}, "right": {"type": "BinaryOperation", "operator": "+", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "sUSD"}}, "right": {"type": "Identifier", "name": "_amt"}}}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "maxLoanAmt"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}}]}, "FalseBody": null}, {"type": "BooleanLiteral", "value": true}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "loanExpired_Close", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "||", "left": {"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "lender"}}, "right": {"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "trader"}}}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "Identifier", "name": "isLoanExpired"}, "arguments": [], "names": []}, {"type": "StringLiteral", "value": "loan has not expired"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "maxLoanAmt"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "totalRemainaingUSD", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_usdAssigned", "storageLocation": null}], "initialValue": null}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_weiAssigned", "storageLocation": null}], "initialValue": null}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "TupleExpression", "components": [{"type": "Identifier", "name": "_usdAssigned"}, {"type": "Identifier", "name": "_weiAssigned"}], "isArray": false}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "_determineAssignableAmt"}, "arguments": [{"type": "Identifier", "name": "totalRemainaingUSD"}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "synthBalanceTrader"}, "arguments": [{"type": "Identifier", "name": "sUSD"}], "names": []}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRate"}, "arguments": [{"type": "Identifier", "name": "sUSD"}], "names": []}], "names": []}}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_weiAssigned"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "totalRemainaingUSD"}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "sub"}, "arguments": [{"type": "Identifier", "name": "totalRemainaingUSD"}, {"type": "Identifier", "name": "_usdAssigned"}], "names": []}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "sUSD"}}, "right": {"type": "BinaryOperation", "operator": "+", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "sUSD"}}, "right": {"type": "Identifier", "name": "_weiAssigned"}}}}]}, "FalseBody": null}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "totalRemainaingUSD"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lastLoanSettleTS"}, "right": {"type": "Identifier", "name": "now"}}}, {"type": "BooleanLiteral", "value": true}]}, "FalseBody": null}, {"type": "ForStatement", "initExpression": {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "i", "storageLocation": null}], "initialValue": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "conditionExpression": {"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "i"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "approvedSynths"}, "memberName": "length"}}, "loopExpression": {"type": "ExpressionStatement", "expression": {"type": "UnaryOperation", "operator": "++", "subExpression": {"type": "Identifier", "name": "i"}, "isPrefix": false}}, "body": {"type": "Block", "statements": [{"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "!=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}, "right": {"type": "Identifier", "name": "sUSD"}}, "TrueBody": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "_synth", "storageLocation": null}], "initialValue": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "TupleExpression", "components": [{"type": "Identifier", "name": "_usdAssigned"}, {"type": "Identifier", "name": "_weiAssigned"}], "isArray": false}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "_determineAssignableAmt"}, "arguments": [{"type": "Identifier", "name": "totalRemainaingUSD"}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "synthBalanceTrader"}, "arguments": [{"type": "Identifier", "name": "_synth"}], "names": []}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRate"}, "arguments": [{"type": "Identifier", "name": "_synth"}], "names": []}], "names": []}}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_weiAssigned"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "totalRemainaingUSD"}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "sub"}, "arguments": [{"type": "Identifier", "name": "totalRemainaingUSD"}, {"type": "Identifier", "name": "_usdAssigned"}], "names": []}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "_synth"}}, "right": {"type": "BinaryOperation", "operator": "+", "left": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "_synth"}}, "right": {"type": "Identifier", "name": "_weiAssigned"}}}}]}, "FalseBody": null}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "totalRemainaingUSD"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lastLoanSettleTS"}, "right": {"type": "Identifier", "name": "now"}}}, {"type": "BooleanLiteral", "value": true}]}, "FalseBody": null}]}, "FalseBody": null}]}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "TupleExpression", "components": [{"type": "Identifier", "name": "_usdAssigned"}, {"type": "Identifier", "name": "_weiAssigned"}], "isArray": false}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "_determineAssignableAmt"}, "arguments": [{"type": "Identifier", "name": "totalRemainaingUSD"}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "sub"}, "arguments": [{"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, "memberName": "balance"}, {"type": "Identifier", "name": "lenderEthBalance"}], "names": []}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRate"}, "arguments": [{"type": "Identifier", "name": "sETH"}], "names": []}], "names": []}}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_weiAssigned"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "totalRemainaingUSD"}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "sub"}, "arguments": [{"type": "Identifier", "name": "totalRemainaingUSD"}, {"type": "Identifier", "name": "_usdAssigned"}], "names": []}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lenderEthBalance"}, "right": {"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "lenderEthBalance"}, "right": {"type": "Identifier", "name": "_weiAssigned"}}}}]}, "FalseBody": null}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "totalRemainaingUSD"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lastLoanSettleTS"}, "right": {"type": "Identifier", "name": "now"}}}, {"type": "BooleanLiteral", "value": true}]}, "FalseBody": null}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "Identifier", "name": "totalRemainaingUSD"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "lastLoanSettleTS"}, "right": {"type": "Identifier", "name": "now"}}}, {"type": "BooleanLiteral", "value": false}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "isLiquidationable", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "IfStatement", "condition": {"type": "Identifier", "name": "wasLiquidated"}, "TrueBody": {"type": "Block", "statements": [{"type": "BooleanLiteral", "value": false}]}, "FalseBody": null}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "sv", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "traderTotSynthValueUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "lv", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "cv", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "collValueUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "f", "storageLocation": null}], "initialValue": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "+", "left": {"type": "BinaryOperation", "operator": "**", "left": {"type": "NumberLiteral", "number": "10", "subdenomination": null}, "right": {"type": "NumberLiteral", "number": "18", "subdenomination": null}}, "right": {"type": "BinaryOperation", "operator": "*", "left": {"type": "BinaryOperation", "operator": "*", "left": {"type": "Identifier", "name": "mm"}, "right": {"type": "NumberLiteral", "number": "10", "subdenomination": null}}, "right": {"type": "NumberLiteral", "number": "14", "subdenomination": null}}}], "isArray": false}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">", "left": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "sv"}, "right": {"type": "Identifier", "name": "cv"}}], "isArray": false}, "right": {"type": "BinaryOperation", "operator": "/", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "f"}, {"type": "Identifier", "name": "lv"}], "names": []}, "right": {"type": "Identifier", "name": "e18"}}}, "TrueBody": {"type": "Block", "statements": [{"type": "BooleanLiteral", "value": false}]}, "FalseBody": null}, {"type": "BooleanLiteral", "value": true}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "isInitialMarginSatisfied", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_sv", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_cv", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_lv", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_mm", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "f", "storageLocation": null}], "initialValue": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "+", "left": {"type": "BinaryOperation", "operator": "**", "left": {"type": "NumberLiteral", "number": "10", "subdenomination": null}, "right": {"type": "NumberLiteral", "number": "18", "subdenomination": null}}, "right": {"type": "BinaryOperation", "operator": "*", "left": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "_mm"}, "right": {"type": "Identifier", "name": "IM_BUFFER_OVER_MM"}}], "isArray": false}, "right": {"type": "BinaryOperation", "operator": "**", "left": {"type": "NumberLiteral", "number": "10", "subdenomination": null}, "right": {"type": "NumberLiteral", "number": "14", "subdenomination": null}}}}], "isArray": false}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">=", "left": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "_sv"}, "right": {"type": "Identifier", "name": "_cv"}}], "isArray": false}, "right": {"type": "BinaryOperation", "operator": "/", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "f"}, {"type": "Identifier", "name": "_lv"}], "names": []}, "right": {"type": "Identifier", "name": "e18"}}}, "TrueBody": {"type": "Block", "statements": [{"type": "BooleanLiteral", "value": true}]}, "FalseBody": null}, {"type": "BooleanLiteral", "value": false}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "pure"}, {"type": "FunctionDefinition", "name": "getRate", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "ExchRatesInterface"}, "arguments": [{"type": "Identifier", "name": "exchRateAddress"}], "names": []}, "memberName": "rateForCurrency"}, "arguments": [{"type": "Identifier", "name": "currencyKey"}], "names": []}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "getRates", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "length": null}, "name": "currencyKeys", "storageLocation": "memory", "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "uint"}, "length": null}, "name": null, "storageLocation": "memory", "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "ExchRatesInterface"}, "arguments": [{"type": "Identifier", "name": "exchRateAddress"}], "names": []}, "memberName": "ratesForCurrencies"}, "arguments": [{"type": "Identifier", "name": "currencyKeys"}], "names": []}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "traderTotSynthValueUSD", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ArrayTypeName", "baseTypeName": {"type": "ElementaryTypeName", "name": "uint"}, "length": null}, "name": "rates", "storageLocation": "memory"}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRates"}, "arguments": [{"type": "Identifier", "name": "approvedSynths"}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "value", "storageLocation": null}], "initialValue": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, {"type": "ForStatement", "initExpression": {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "i", "storageLocation": null}], "initialValue": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "conditionExpression": {"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "i"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "approvedSynths"}, "memberName": "length"}}, "loopExpression": {"type": "ExpressionStatement", "expression": {"type": "UnaryOperation", "operator": "++", "subExpression": {"type": "Identifier", "name": "i"}, "isPrefix": false}}, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "value"}, "right": {"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "value"}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "_synthValueUSD"}, "arguments": [{"type": "IndexAccess", "base": {"type": "Identifier", "name": "rates"}, "index": {"type": "Identifier", "name": "i"}}, {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "synthBalanceTrader"}, "arguments": [{"type": "IndexAccess", "base": {"type": "Identifier", "name": "approvedSynths"}, "index": {"type": "Identifier", "name": "i"}}], "names": []}], "names": []}}}}]}}, {"type": "Identifier", "name": "value"}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "synthBalanceTrader", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bytes32"}, "name": "currencyKey", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_bal", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "SynthInterface"}, "arguments": [{"type": "IndexAccess", "base": {"type": "Identifier", "name": "synthToAddress"}, "index": {"type": "Identifier", "name": "currencyKey"}}], "names": []}, "memberName": "balanceOf"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}], "names": []}}, {"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "_bal"}, "right": {"type": "IndexAccess", "base": {"type": "Identifier", "name": "lenderSynthBalances"}, "index": {"type": "Identifier", "name": "currencyKey"}}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "loanBalUSD", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "interest", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "calcInterest"}, "arguments": [{"type": "Identifier", "name": "APR"}, {"type": "Identifier", "name": "loanBalance"}, {"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "now"}, "right": {"type": "Identifier", "name": "lastLoanSettleTS"}}], "names": []}}, {"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "loanBalance"}, "right": {"type": "Identifier", "name": "interest"}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "collValueUSD", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "BinaryOperation", "operator": "/", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "Identifier", "name": "getRate"}, "arguments": [{"type": "Identifier", "name": "sETH"}], "names": []}, {"type": "BinaryOperation", "operator": "-", "left": {"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, "memberName": "balance"}, "right": {"type": "Identifier", "name": "lenderEthBalance"}}], "names": []}, "right": {"type": "NumberLiteral", "number": "1e18", "subdenomination": null}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "traderEthBalance", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "FunctionCall", "expression": {"type": "Identifier", "name": "sub"}, "arguments": [{"type": "MemberAccess", "expression": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, "memberName": "balance"}, {"type": "Identifier", "name": "lenderEthBalance"}], "names": []}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "isLoanExpired", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "BinaryOperation", "operator": ">", "left": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "now"}, "right": {"type": "Identifier", "name": "loanStartTS"}}], "isArray": false}, "right": {"type": "Identifier", "name": "maxDurationSecs"}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "levTimes100", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "sv", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "traderTotSynthValueUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "lv", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "loanBalUSD"}, "arguments": [], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "cv", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "collValueUSD"}, "arguments": [], "names": []}}, {"type": "BinaryOperation", "operator": "/", "left": {"type": "BinaryOperation", "operator": "*", "left": {"type": "NumberLiteral", "number": "100", "subdenomination": null}, "right": {"type": "Identifier", "name": "lv"}}, "right": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "-", "left": {"type": "BinaryOperation", "operator": "+", "left": {"type": "Identifier", "name": "sv"}, "right": {"type": "Identifier", "name": "cv"}}, "right": {"type": "Identifier", "name": "lv"}}], "isArray": false}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "calcInterest", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_APR", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "elapsedTime", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "n", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "elapsedTime"}, {"type": "NumberLiteral", "number": "1000000", "subdenomination": null}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "n"}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "n"}, {"type": "Identifier", "name": "amount"}], "names": []}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "n"}, "right": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "n"}, {"type": "Identifier", "name": "_APR"}], "names": []}}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "d", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "SECONDS_IN_YEAR"}, {"type": "NumberLiteral", "number": "10000000000", "subdenomination": null}], "names": []}}, {"type": "BinaryOperation", "operator": "/", "left": {"type": "Identifier", "name": "n"}, "right": {"type": "Identifier", "name": "d"}}]}, "visibility": "private", "modifiers": [], "isConstructor": false, "stateMutability": "pure"}, {"type": "FunctionDefinition", "name": "_determineAssignableAmt", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "maxAssignUSD", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "balWei", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "rate", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amtAssignableUSD", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "amtAssignableSynth", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "balWei"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "TupleExpression", "components": [{"type": "NumberLiteral", "number": "0", "subdenomination": null}, {"type": "NumberLiteral", "number": "0", "subdenomination": null}], "isArray": false}]}, "FalseBody": null}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "balUSD", "storageLocation": null}], "initialValue": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "_synthValueUSD"}, "arguments": [{"type": "Identifier", "name": "rate"}, {"type": "Identifier", "name": "balWei"}], "names": []}}, {"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">=", "left": {"type": "Identifier", "name": "maxAssignUSD"}, "right": {"type": "Identifier", "name": "balUSD"}}, "TrueBody": {"type": "Block", "statements": [{"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "maxAssignUSD"}, "right": {"type": "Identifier", "name": "balUSD"}}, {"type": "Identifier", "name": "balWei"}], "isArray": false}]}, "FalseBody": {"type": "Block", "statements": [{"type": "TupleExpression", "components": [{"type": "Identifier", "name": "maxAssignUSD"}, {"type": "BinaryOperation", "operator": "/", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "balWei"}, {"type": "Identifier", "name": "maxAssignUSD"}], "names": []}, "right": {"type": "Identifier", "name": "balUSD"}}], "isArray": false}]}}]}, "visibility": "private", "modifiers": [], "isConstructor": false, "stateMutability": "pure"}, {"type": "FunctionDefinition", "name": "mul", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "a", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "b", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "c", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "a"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, "TrueBody": {"type": "Block", "statements": [{"type": "NumberLiteral", "number": "0", "subdenomination": null}]}, "FalseBody": null}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "c"}, "right": {"type": "BinaryOperation", "operator": "*", "left": {"type": "Identifier", "name": "a"}, "right": {"type": "Identifier", "name": "b"}}}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "assert"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "BinaryOperation", "operator": "/", "left": {"type": "Identifier", "name": "c"}, "right": {"type": "Identifier", "name": "a"}}, "right": {"type": "Identifier", "name": "b"}}], "names": []}}, {"type": "Identifier", "name": "c"}]}, "visibility": "internal", "modifiers": [], "isConstructor": false, "stateMutability": "pure"}, {"type": "FunctionDefinition", "name": "sub", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "a", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "b", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "IfStatement", "condition": {"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "b"}, "right": {"type": "Identifier", "name": "a"}}, "TrueBody": {"type": "Block", "statements": [{"type": "NumberLiteral", "number": "0", "subdenomination": null}]}, "FalseBody": null}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "c", "storageLocation": null}], "initialValue": {"type": "BinaryOperation", "operator": "-", "left": {"type": "Identifier", "name": "a"}, "right": {"type": "Identifier", "name": "b"}}}, {"type": "Identifier", "name": "c"}]}, "visibility": "internal", "modifiers": [], "isConstructor": false, "stateMutability": "pure"}, {"type": "FunctionDefinition", "name": "_synthValueUSD", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "rate", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "balance", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": {"type": "Block", "statements": [{"type": "BinaryOperation", "operator": "/", "left": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "mul"}, "arguments": [{"type": "Identifier", "name": "rate"}, {"type": "Identifier", "name": "balance"}], "names": []}, "right": {"type": "Identifier", "name": "e18"}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": "pure"}], "kind": "contract"}]}