{"type": "SourceUnit", "children": [{"type": "PragmaDirective", "name": "solidity", "value": "^0.5.0"}, {"type": "ContractDefinition", "name": "IERC20", "baseContracts": [], "subNodes": [{"type": "FunctionDefinition", "name": "totalSupply", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "balanceOf", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "account", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "transfer", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "recipient", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "allowance", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "owner", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "spender", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": "view"}, {"type": "FunctionDefinition", "name": "approve", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "spender", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "transferFrom", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "sender", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "recipient", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "amount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "bool"}, "name": null, "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "body": [], "visibility": "external", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "EventDefinition", "name": "Transfer", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "from", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "to", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "value", "isStateVar": false, "isIndexed": false}]}, "isAnonymous": false}, {"type": "EventDefinition", "name": "Approval", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "owner", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "spender", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "value", "isStateVar": false, "isIndexed": false}]}, "isAnonymous": false}], "kind": "interface"}, {"type": "PragmaDirective", "name": "solidity", "value": "0.5.8"}, {"type": "ContractDefinition", "name": "CoveredCall", "baseContracts": [], "subNodes": [{"type": "EnumDefinition", "name": "ContractStates", "members": [{"type": "EnumValue", "name": "NONE"}, {"type": "EnumValue", "name": "STATUS_INITIALIZED"}, {"type": "EnumValue", "name": "STATUS_OPEN"}, {"type": "EnumValue", "name": "STATUS_REDEEMED"}, {"type": "EnumValue", "name": "STATUS_CLOSED"}]}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "UserDefinedTypeName", "namePath": "ContractStates"}, "name": "currentState", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "EventDefinition", "name": "PremiumUpdated", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "_seller", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_oldPremiumAmount", "isStateVar": false, "isIndexed": false}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_newPremiumAmount", "isStateVar": false, "isIndexed": false}]}, "isAnonymous": false}, {"type": "EventDefinition", "name": "Initialized", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "_seller", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_underlyingAssetAmount", "isStateVar": false, "isIndexed": false}]}, "isAnonymous": false}, {"type": "EventDefinition", "name": "Opened", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "_buyer", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_purchaseAmount", "isStateVar": false, "isIndexed": false}]}, "isAnonymous": false}, {"type": "EventDefinition", "name": "Redeemed", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "_buyer", "isStateVar": false, "isIndexed": true}, {"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_paymentAmount", "isStateVar": false, "isIndexed": false}]}, "isAnonymous": false}, {"type": "EventDefinition", "name": "Closed", "parameters": {"type": "ParameterList", "parameters": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "_seller", "isStateVar": false, "isIndexed": true}]}, "isAnonymous": false}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "buyer", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "address"}, "name": "seller", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "UserDefinedTypeName", "namePath": "IERC20"}, "name": "underlyingAssetToken", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "UserDefinedTypeName", "namePath": "IERC20"}, "name": "purchasingToken", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "underlyingAssetAmount", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "strikePrice", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "premiumAmount", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "StateVariableDeclaration", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "expirationDate", "expression": null, "visibility": "public", "isStateVar": true, "isDeclaredConst": false, "isIndexed": false}], "initialValue": null}, {"type": "FunctionDefinition", "name": null, "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "UserDefinedTypeName", "namePath": "IERC20"}, "name": "_underlyingAssetToken", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_underlyingAssetAmount", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "UserDefinedTypeName", "namePath": "IERC20"}, "name": "_purchasingToken", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_strikePrice", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_premiumAmount", "storageLocation": null, "isStateVar": false, "isIndexed": false}, {"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint"}, "name": "_expirationDate", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": null, "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "!=", "left": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "_underlyingAssetToken"}], "names": []}, "right": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "NumberLiteral", "number": "0", "subdenomination": null}], "names": []}}, {"type": "StringLiteral", "value": "The asset token must not be 0x0"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_underlyingAssetAmount"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, {"type": "StringLiteral", "value": "The asset amount must be valid"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "!=", "left": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "_purchasingToken"}], "names": []}, "right": {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "NumberLiteral", "number": "0", "subdenomination": null}], "names": []}}, {"type": "StringLiteral", "value": "The purchasing token must not be 0x0"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_strikePrice"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, {"type": "StringLiteral", "value": "The strike price must be valid"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_premiumAmount"}, "right": {"type": "NumberLiteral", "number": "0", "subdenomination": null}}, {"type": "StringLiteral", "value": "The premium amount price must be valid"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "_expirationDate"}, "right": {"type": "Identifier", "name": "now"}}, {"type": "StringLiteral", "value": "The expiration must be in the future"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "seller"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "underlyingAssetToken"}, "right": {"type": "Identifier", "name": "_underlyingAssetToken"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "underlyingAssetAmount"}, "right": {"type": "Identifier", "name": "_underlyingAssetAmount"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "purchasingToken"}, "right": {"type": "Identifier", "name": "_purchasingToken"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "strikePrice"}, "right": {"type": "Identifier", "name": "_strikePrice"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "premiumAmount"}, "right": {"type": "Identifier", "name": "_premiumAmount"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "expirationDate"}, "right": {"type": "Identifier", "name": "_expirationDate"}}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "NONE"}}}]}, "visibility": "public", "modifiers": [], "isConstructor": true, "stateMutability": null}, {"type": "FunctionDefinition", "name": "initialize", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "NONE"}}, {"type": "StringLiteral", "value": "Contract must be in NONE state to allow initialization"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "seller"}}, {"type": "StringLiteral", "value": "Only the original seller can initialize the contract"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "underlyingAssetToken"}, "memberName": "transferFrom"}, "arguments": [{"type": "Identifier", "name": "seller"}, {"type": "FunctionCall", "expression": {"type": "ElementaryTypeNameExpression", "typeName": {"type": "ElementaryTypeName", "name": "address"}}, "arguments": [{"type": "Identifier", "name": "this"}], "names": []}, {"type": "Identifier", "name": "underlyingAssetAmount"}], "names": []}, {"type": "StringLiteral", "value": "Must provide initial escrow token"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_INITIALIZED"}}}, {"type": "EmitStatement", "eventCall": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "Initialized"}, "arguments": [{"type": "Identifier", "name": "seller"}, {"type": "Identifier", "name": "underlyingAssetAmount"}], "names": []}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "updatePremium", "parameters": {"type": "ParameterList", "parameters": [{"type": "Parameter", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "_premiumAmount", "storageLocation": null, "isStateVar": false, "isIndexed": false}]}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_INITIALIZED"}}, {"type": "StringLiteral", "value": "Contract must be in initialized state to allow updates of the premium"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "seller"}}, {"type": "StringLiteral", "value": "Only the original seller can update the premium"}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "oldPremiumAmount", "storageLocation": null}], "initialValue": {"type": "Identifier", "name": "premiumAmount"}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "premiumAmount"}, "right": {"type": "Identifier", "name": "_premiumAmount"}}}, {"type": "EmitStatement", "eventCall": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "PremiumUpdated"}, "arguments": [{"type": "Identifier", "name": "seller"}, {"type": "Identifier", "name": "oldPremiumAmount"}, {"type": "Identifier", "name": "premiumAmount"}], "names": []}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "open", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "now"}, "right": {"type": "Identifier", "name": "expirationDate"}}, {"type": "StringLiteral", "value": "Cannot open an expired contract"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_INITIALIZED"}}, {"type": "StringLiteral", "value": "Contract must be in initialized state to open"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "buyer"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "purchasingToken"}, "memberName": "transferFrom"}, "arguments": [{"type": "Identifier", "name": "buyer"}, {"type": "Identifier", "name": "seller"}, {"type": "Identifier", "name": "premiumAmount"}], "names": []}, {"type": "StringLiteral", "value": "Must pay premium to open contract"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_OPEN"}}}, {"type": "EmitStatement", "eventCall": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "Opened"}, "arguments": [{"type": "Identifier", "name": "buyer"}, {"type": "Identifier", "name": "premiumAmount"}], "names": []}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "close", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "||", "left": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_INITIALIZED"}}, "right": {"type": "TupleExpression", "components": [{"type": "BinaryOperation", "operator": "&&", "left": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_OPEN"}}, "right": {"type": "BinaryOperation", "operator": ">", "left": {"type": "Identifier", "name": "now"}, "right": {"type": "Identifier", "name": "expirationDate"}}}], "isArray": false}}, {"type": "StringLiteral", "value": "Contract must be in initialized state or expired in order to close it"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "seller"}}, {"type": "StringLiteral", "value": "Only the original seller can close a contract"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "underlyingAssetToken"}, "memberName": "transfer"}, "arguments": [{"type": "Identifier", "name": "seller"}, {"type": "Identifier", "name": "underlyingAssetAmount"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_CLOSED"}}}, {"type": "EmitStatement", "eventCall": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "Closed"}, "arguments": [{"type": "Identifier", "name": "seller"}], "names": []}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}, {"type": "FunctionDefinition", "name": "redeem", "parameters": {"type": "ParameterList", "parameters": []}, "returnParameters": [], "body": {"type": "Block", "statements": [{"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "&&", "left": {"type": "BinaryOperation", "operator": "==", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_OPEN"}}, "right": {"type": "BinaryOperation", "operator": "<", "left": {"type": "Identifier", "name": "now"}, "right": {"type": "Identifier", "name": "expirationDate"}}}, {"type": "StringLiteral", "value": "Contract must be in open state and not expired to redeem it"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "BinaryOperation", "operator": "==", "left": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "msg"}, "memberName": "sender"}, "right": {"type": "Identifier", "name": "buyer"}}, {"type": "StringLiteral", "value": "Only the original buyer can redeem a contract"}], "names": []}}, {"type": "VariableDeclarationStatement", "variables": [{"type": "VariableDeclaration", "typeName": {"type": "ElementaryTypeName", "name": "uint256"}, "name": "paymentAmount", "storageLocation": null}], "initialValue": {"type": "BinaryOperation", "operator": "*", "left": {"type": "Identifier", "name": "underlyingAssetAmount"}, "right": {"type": "Identifier", "name": "strikePrice"}}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "require"}, "arguments": [{"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "purchasingToken"}, "memberName": "transferFrom"}, "arguments": [{"type": "Identifier", "name": "buyer"}, {"type": "Identifier", "name": "seller"}, {"type": "Identifier", "name": "paymentAmount"}], "names": []}, {"type": "StringLiteral", "value": "Must pay amount * strike to redeem contract"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "FunctionCall", "expression": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "underlyingAssetToken"}, "memberName": "transfer"}, "arguments": [{"type": "Identifier", "name": "buyer"}, {"type": "Identifier", "name": "underlyingAssetAmount"}], "names": []}}, {"type": "ExpressionStatement", "expression": {"type": "BinaryOperation", "operator": "=", "left": {"type": "Identifier", "name": "currentState"}, "right": {"type": "MemberAccess", "expression": {"type": "Identifier", "name": "ContractStates"}, "memberName": "STATUS_REDEEMED"}}}, {"type": "EmitStatement", "eventCall": {"type": "FunctionCall", "expression": {"type": "Identifier", "name": "Redeemed"}, "arguments": [{"type": "Identifier", "name": "buyer"}, {"type": "Identifier", "name": "paymentAmount"}], "names": []}}]}, "visibility": "public", "modifiers": [], "isConstructor": false, "stateMutability": null}], "kind": "contract"}]}